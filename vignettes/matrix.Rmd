---
title: "Pattern Causality in a Large Dataset"
author: "Stavros Stavroglou, Athanasios Pantelous, Hui Wang"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Pattern Causality in a Large Dataset}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include = FALSE}
  knitr::opts_chunk$set(
  warning = FALSE,
  collapse = TRUE,
  comment = "#>",
  fig.width = 8,
    fig.height = 6
)
```

This vignette demonstrates the analysis of pattern causality in large-scale systems with multiple interconnected time series. Key aspects covered include:

1. Matrix-based causality analysis
2. System-wide pattern detection
3. Visualization of complex causal networks
4. Effect analysis across the entire system

The matrix approach is particularly useful for:
- Financial market networks
- Economic systems
- Social networks
- Complex ecological systems

## Pattern Causality Matrix

We'll use the DJS dataset which contains 29 stock price series - a sufficiently large dataset for our analysis.

```{r message=FALSE}
library(patterncausality)
data(DJS)
#head(DJS)
```

First, let's find optimal parameters for our analysis:

```{r eval=FALSE}
dataset <- DJS[,-1] # remove the date column
params <- optimalParametersSearch(
  Emax = 3, 
  tauMax = 3, 
  metric = "euclidean", 
  dataset = dataset,
  verbose = FALSE
)
print(params)
```

Now we can estimate the pattern causality using the optimal parameters:

```{r eval=FALSE}
result <- pcMatrix(
  dataset = dataset, 
  E = 3,           # Embedding dimension
  tau = 1,         # Time delay
  metric = "euclidean",
  h = 1,           # Prediction horizon
  weighted = FALSE  # Unweighted analysis
)
```

```{r echo=FALSE}
result <- readRDS("DJSm.rds")
result$is_square <- TRUE
```

Then we could see the three matrixs after calculating.
```{r}
print(result)
```

Then we can visualize the result by `plotMatrix` function.

- positive status

```{r}
plot(result, "positive") + ggplot2::coord_fixed()
```

- negative status

```{r}
plot(result, "negative") + ggplot2::coord_fixed()
```

- dark status

```{r}
plot(result, "dark") + ggplot2::coord_fixed()
```

We could see that there is a obvious positive connection in this system.

## Pattern causality effect

After we get the matrix, we can find the total effect in the system, we provide the function `pcEffect` to achieve this target.

```{r}
effects <- pcEffect(result)
print(effects)
```

Then we could observe the total effect in pattern causality.

```{r}
plot(effects, status="negative") + ggplot2::coord_fixed()
```